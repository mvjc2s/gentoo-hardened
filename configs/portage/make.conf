# /etc/portage/make.conf
# Gentoo Hardened - Lenovo LOQ
#
# Documentação: https://wiki.gentoo.org/wiki//etc/portage/make.conf
#

# =============================================================================
# COMPILADOR
# =============================================================================

# Flags de compilação otimizadas para CPU nativa
# -march=native detecta automaticamente sua CPU
# -O2 é o nível de otimização recomendado
# -pipe usa pipes em vez de arquivos temporários (mais rápido, usa mais RAM)
COMMON_FLAGS="-march=native -O2 -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
FCFLAGS="${COMMON_FLAGS}"
FFLAGS="${COMMON_FLAGS}"

# Linker flags (opcional, para Link Time Optimization)
# LDFLAGS="-Wl,-O1 -Wl,--as-needed"

# =============================================================================
# PARALELISMO
# =============================================================================

# Número de jobs paralelos para make
# Regra geral: número de CPUs + 1
# Ajuste conforme RAM disponível (cada job pode usar 1-2GB)
MAKEOPTS="-j9 -l8"

# Jobs paralelos para emerge
# Cuidado: emerge paralelo * make paralelo pode sobrecarregar
EMERGE_DEFAULT_OPTS="--jobs=4 --load-average=8 --with-bdeps=y --complete-graph=y"

# =============================================================================
# ARQUITETURA
# =============================================================================

# NUNCA altere CHOST após instalação sem ler a documentação
CHOST="x86_64-pc-linux-gnu"

# Arquitetura alvo
ACCEPT_KEYWORDS="amd64"

# Licenças aceitas
# @FREE = apenas licenças livres
# Adicione específicas conforme necessidade
ACCEPT_LICENSE="-* @FREE @BINARY-REDISTRIBUTABLE"

# =============================================================================
# USE FLAGS
# =============================================================================

# USE flags globais
# Mantenha mínimo aqui, use package.use para específicos
USE="
    hardened
    -systemd
    -pulseaudio pipewire
    wayland -X
    -bluetooth
    -cups
    zstd lz4
    threads
"

# CPU flags - geradas por cpuid2cpuflags
# Execute: cpuid2cpuflags
# Exemplo para Intel moderno:
CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 ssse3"

# =============================================================================
# HARDWARE
# =============================================================================

# Placas de vídeo
# nvidia: para driver proprietário NVIDIA
# intel: para Intel iGPU (ou amdgpu se for AMD)
VIDEO_CARDS="nvidia intel"

# Dispositivos de entrada
INPUT_DEVICES="libinput"

# =============================================================================
# DIRETÓRIOS
# =============================================================================

PORTDIR="/var/db/repos/gentoo"
DISTDIR="/var/cache/distfiles"
PKGDIR="/var/cache/binpkgs"

# =============================================================================
# LOCALIZAÇÃO
# =============================================================================

# Mensagens de compilação em inglês (facilita buscar erros)
LC_MESSAGES=C.UTF-8

# Idiomas para aplicações
L10N="en pt-BR"
LINGUAS="en pt_BR"

# =============================================================================
# LOGGING
# =============================================================================

# Classes de log a capturar
PORTAGE_ELOG_CLASSES="info warn error log qa"

# Onde salvar logs
PORTAGE_ELOG_SYSTEM="echo save"

# =============================================================================
# FEATURES
# =============================================================================

FEATURES="
    split-elog
    buildpkg
    parallel-fetch
    candy
    unmerge-orphans
    userfetch
    userpriv
    usersandbox
"

# Para binpkgs assinados (opcional):
# FEATURES="${FEATURES} binpkg-signing"
# BINPKG_GPG_SIGNING_GPG_HOME="/etc/portage/gnupg"

# =============================================================================
# MIRRORS
# =============================================================================

# Mirrors brasileiros e fallback
# Gere com: mirrorselect -i -o
GENTOO_MIRRORS="
    https://gentoo.c3sl.ufpr.br/
    https://www.mirrorservice.org/sites/distfiles.gentoo.org/
    https://mirrors.kernel.org/gentoo/
"

# =============================================================================
# PORTAGE TMPDIR (opcional)
# =============================================================================

# Se usar tmpfs para compilação:
# PORTAGE_TMPDIR="/var/tmp/portage"
# Configure em /etc/fstab:
# tmpfs /var/tmp/portage tmpfs size=16G,uid=portage,gid=portage,mode=775 0 0

# =============================================================================
# GRUB (não usado neste setup, mas documentado)
# =============================================================================

# GRUB_PLATFORMS="efi-64"

# =============================================================================
# NOTAS
# =============================================================================

# Este arquivo é um template. Ajuste conforme seu hardware:
#
# 1. CPU_FLAGS_X86: execute cpuid2cpuflags e cole o resultado
# 2. VIDEO_CARDS: ajuste para seu hardware
#    - Intel + NVIDIA: "nvidia intel"
#    - AMD + NVIDIA: "nvidia amdgpu"
#    - Apenas AMD: "amdgpu radeonsi"
# 3. MAKEOPTS: ajuste -j baseado em CPU e RAM
# 4. USE: adicione/remova conforme necessidade
